<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - Freelancer Marketplace</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav id="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">Freelancer<span>.</span></a>
            <button class="mobile-menu-btn" aria-label="Toggle menu">‚ò∞</button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="messages.html">Messages</a></li>
                <li><a href="notifications.html">Notifications</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <section class="section notifications-section">
            <div class="notifications-header">
                <h1>Notifications</h1>
                <div class="notifications-controls">
                    <button class="filter-btn active" onclick="filterNotifications('all')">All</button>
                    <button class="filter-btn" onclick="filterNotifications('unread')">Unread</button>
                    <button class="filter-btn" onclick="filterNotifications('applications')">Applications</button>
                    <button class="filter-btn" onclick="filterNotifications('messages')">Messages</button>
                    <button class="btn-secondary" onclick="markAllAsRead()">Mark All as Read</button>
                </div>
            </div>

            <div id="notificationsList" class="notifications-list">
                <!-- Loaded dynamically -->
            </div>
        </section>
    </main>

    <button class="scroll-to-top" id="scrollToTop" aria-label="Scroll to top">‚Üë</button>

    <footer>
        <div class="social-icons">
            <a href="https://t.me/rundilundlegamera" target="_blank" rel="noopener noreferrer" aria-label="Telegram">
                <svg viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet">
                    <path d="M 200.894531 323.863281 L 192.425781 442.988281 C 204.542969 442.988281 209.792969 437.78125 216.085938 431.53125 L 272.894531 377.238281 L 390.613281 463.445312 C 412.203125 475.476562 427.414062 469.140625 433.238281 443.585938 L 510.507812 81.515625 L 510.527344 81.492188 C 517.375 49.578125 498.988281 37.097656 477.953125 44.929688 L 23.765625 218.816406 C -7.230469 230.847656 -6.761719 248.128906 18.496094 255.957031 L 134.613281 292.074219 L 404.332031 123.308594 C 417.023438 114.902344 428.566406 119.550781 419.070312 127.957031 Z M 200.894531 323.863281 "></path>
                </svg>
            </a>
        </div>
        <p>&copy; <span id="current-year"></span> Freelancer Marketplace. All rights reserved.</p>
    </footer>

    <script src="script.js"></script>
    <script>
        let allNotifications = [];
        let currentFilter = 'all';

        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }

        async function loadNotifications() {
            try {
                const user = JSON.parse(localStorage.getItem('user'));
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }

                const db = JSON.parse(localStorage.getItem('database') || '{"notifications":[]}');
                
                // Get notifications for current user
                allNotifications = db.notifications.filter(notif => 
                    notif.userId === user.id
                ).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                displayNotifications(allNotifications);
            } catch (error) {
                console.error('[v0] Error loading notifications:', error);
            }
        }

        function displayNotifications(notifications) {
            const list = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #bbb; padding: 40px;">No notifications</p>';
                return;
            }

            list.innerHTML = notifications.map((notif, index) => `
                <div class="notification-item ${notif.read ? '' : 'unread'}">
                    <div class="notification-icon">${getNotificationIcon(notif.type)}</div>
                    <div class="notification-content">
                        <h4>${notif.title}</h4>
                        <p>${notif.message}</p>
                        <span class="notification-time">${getTimeAgo(notif.timestamp)}</span>
                    </div>
                    <div class="notification-actions">
                        ${!notif.read ? `<button class="btn-small" onclick="markAsRead(${index})">Mark as Read</button>` : ''}
                        <button class="btn-small btn-danger" onclick="deleteNotification(${index})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function getNotificationIcon(type) {
            const icons = {
                'application': 'üìã',
                'message': 'üí¨',
                'hire': '‚úÖ',
                'rejection': '‚ùå',
                'payment': 'üí∞',
                'review': '‚≠ê'
            };
            return icons[type] || 'üîî';
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diff = now - time;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            
            return time.toLocaleDateString();
        }

        function filterNotifications(type) {
            currentFilter = type;

            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filter and display
            let filtered = allNotifications;
            
            if (type === 'unread') {
                filtered = allNotifications.filter(n => !n.read);
            } else if (type === 'applications') {
                filtered = allNotifications.filter(n => n.type === 'application');
            } else if (type === 'messages') {
                filtered = allNotifications.filter(n => n.type === 'message');
            }

            displayNotifications(filtered);
        }

        function markAsRead(index) {
            try {
                const db = JSON.parse(localStorage.getItem('database') || '{"notifications":[]}');
                const notif = allNotifications[index];
                
                const dbNotif = db.notifications.find(n => n.id === notif.id);
                if (dbNotif) {
                    dbNotif.read = true;
                    localStorage.setItem('database', JSON.stringify(db));
                    loadNotifications();
                }
            } catch (error) {
                console.error('[v0] Error marking as read:', error);
            }
        }

        function markAllAsRead() {
            try {
                const db = JSON.parse(localStorage.getItem('database') || '{"notifications":[]}');
                const user = JSON.parse(localStorage.getItem('user'));
                
                db.notifications.forEach(notif => {
                    if (notif.userId === user.id) {
                        notif.read = true;
                    }
                });
                
                localStorage.setItem('database', JSON.stringify(db));
                loadNotifications();
            } catch (error) {
                console.error('[v0] Error marking all as read:', error);
            }
        }

        function deleteNotification(index) {
            try {
                const db = JSON.parse(localStorage.getItem('database') || '{"notifications":[]}');
                const notif = allNotifications[index];
                
                db.notifications = db.notifications.filter(n => n.id !== notif.id);
                localStorage.setItem('database', JSON.stringify(db));
                loadNotifications();
            } catch (error) {
                console.error('[v0] Error deleting notification:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', loadNotifications);
    </script>
</body>
</html>
